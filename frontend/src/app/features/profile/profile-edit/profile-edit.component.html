<section class="profile-edit-root">

  @if (user) {
    <h1>Mi perfil de {{ roleLabels[user.role] }}:</h1>
  }

  <form [formGroup]="form" (ngSubmit)="onSubmit()">

    <label>Nombre completo</label>
    <input formControlName="fullName" />

    @if (form.get('fullName')?.touched && form.get('fullName')?.invalid) {
      <div class="error">
        @if (form.get('fullName')?.errors?.['required']) {
          <small>El nombre es obligatorio.</small>
        }
        @if (form.get('fullName')?.errors?.['minlength']) {
          <small>Debe tener al menos 3 caracteres.</small>
        }
      </div>
    }

    <label>Email</label>
    <input formControlName="email" type="email" />

    @if (form.get('email')?.touched && form.get('email')?.invalid) {
      <div class="error">
        @if (form.get('email')?.errors?.['required']) {
          <small>El email es obligatorio.</small>
        }
        @if (form.get('email')?.errors?.['realEmail']) {
          <small>Introduce un email válido, por ejemplo: usuario&#64;dominio.com</small>
        }
      </div>
    }

    <button type="submit">
      Guardar cambios
    </button>
  </form>

  <section class="change-password">
    <h2>¿Quieres cambiar tu contraseña?</h2>

    <button type="button" class="btn-secondary" (click)="goToChangePassword()">
        Modificar contraseña
    </button>
  </section>

  <section class="danger-zone">
    <h2>Zona peligrosa</h2>
    <p>Si eliminas tu cuenta, no podrás recuperarla.</p>

    <button type="button" class="btn-delete" (click)="onClickDeleteAccount()">
      Eliminar cuenta
    </button>
  </section>

  <!-- Popup para ACTUALIZAR perfil -->
  @if (showPasswordDialogForUpdate) {
    <app-confirm-password-dialog
      message="Se necesita tu contraseña para continuar:"
      (confirm)="onPasswordConfirmedForUpdate($event)"
      (cancel)="onPasswordDialogUpdateCancelled()"
    />
  }

  <!-- Popup para ELIMINAR cuenta -->
  @if (showPasswordDialogForDelete) {
    <app-confirm-password-dialog
      message="Introduce tu contraseña para eliminar la cuenta:"
      (confirm)="onPasswordConfirmedForDelete($event)"
      (cancel)="onPasswordDialogDeleteCancelled()"
    />
  }

  <!-- Popup de confirmación final de acción -->
  @if (showConfirmDeleteDialog) {
    <app-confirm-action-dialog
      message="¿Seguro que deseas eliminar tu cuenta? Esta acción no se puede deshacer."
      confirmText="Eliminar cuenta"
      cancelText="Cancelar"
      (confirm)="onConfirmDeleteAction()"
      (cancel)="onCancelDeleteAction()"
    />
  }

</section>

